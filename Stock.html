<script>
let total = 0;
let savedItems = JSON.parse(localStorage.getItem("itemsToBuy")) || [];

function saveToLocalStorage() {
  localStorage.setItem("itemsToBuy", JSON.stringify(savedItems));
}

function moveToB(item) {
  const folder = item.dataset.folder;
  const price = parseFloat(item.dataset.price);
  const name = item.dataset.name;

  total += price;
  updateTotal();
  item.onclick = () => moveToA(item);
  document.getElementById(folder + "_B").appendChild(item);

  savedItems.push({ name, folder, price });
  saveToLocalStorage();
}

function moveToA(item) {
  const folder = item.dataset.folder;
  const price = parseFloat(item.dataset.price);
  const name = item.dataset.name;

  total -= price;
  updateTotal();
  item.onclick = () => moveToB(item);
  document.getElementById(folder + "_A").appendChild(item);

  savedItems = savedItems.filter(i => i.name !== name || i.folder !== folder);
  saveToLocalStorage();
}

function updateTotal() {
  document.getElementById("totalPrice").innerText = "Total: RM " + total.toFixed(2);
}

function createFolder(folderName, items) {
  const id = folderName.replace(/\s+/g, "_");

  const divA = document.createElement("div");
  divA.className = "folder";
  divA.innerHTML = `<h3>ðŸ“‚ ${folderName}</h3><ul id="${id}_A"></ul>`;
  document.getElementById("foldersA").appendChild(divA);

  const divB = document.createElement("div");
  divB.className = "folder";
  divB.innerHTML = `<h3>ðŸ“‚ ${folderName}</h3><ul id="${id}_B"></ul>`;
  document.getElementById("foldersB").appendChild(divB);

  for (const [itemName, price] of Object.entries(items)) {
    const li = document.createElement("li");
    li.textContent = `${itemName} - RM${price.toFixed(2)}`;
    li.setAttribute("data-folder", id);
    li.setAttribute("data-price", price);
    li.setAttribute("data-name", itemName);

    const isSaved = savedItems.some(i => i.name === itemName && i.folder === id);

    if (isSaved) {
      li.onclick = () => moveToA(li);
      divB.querySelector("ul").appendChild(li);
      total += price;
    } else {
      li.onclick = () => moveToB(li);
      divA.querySelector("ul").appendChild(li);
    }
  }
}

for (const [folder, itemList] of Object.entries(items)) {
  createFolder(folder, itemList);
}
updateTotal();
</script>
